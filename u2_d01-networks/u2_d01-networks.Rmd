---
title: "Introduction to Networks"
subtitle: "Applications of Data Science"
author: "Giora Simchoni"
institute: "Stat. and OR Department, TAU"
date: "`r Sys.Date()`"
output_dir: "images"
output:
  xaringan::moon_reader:
    css: "../slides.css"
    seal: false
    chakra: "../libs/remark-latest.min.js"
    includes:
      in_header: "../header.html"
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

class: logo-slide

---

class: title-slide

## Introduction to Networks

### Applications of Data Science - Class 6

### Giora Simchoni

#### `gsimchoni@gmail.com and add #dsapps in subject`

### Stat. and OR Department, TAU
### `r Sys.Date()`

---
```{r child = "../setup.Rmd"}
```

```{r packages, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)

printmrow <- function(x) cat(cat(x,sep=" & "),"\\\\")

matrix2latex <- function(matr) {
  cat("$\\begin{bmatrix}")
  body <- apply(matr,1,printmrow)
  cat("\\end{bmatrix}$")
}
```

class: section-slide

# Why Networks?

---

## Because this

<img src = "images/israeli_songs_excel.png" style = "width: 100%">

Can only get you so far.
---

## Divided they sing

<img src = "images/israeli_coops.png" style = "width: 100%">

---

class: section-slide

# Networks Overview

---

## A Network

A network, is comprised of:

- Nodes (vertices, points, actors), joined together in pairs by
- Edges (links, connections, ties)

Many types of networks:

- Physical networks: telephone lines, roads, airline routes, rivers
- Information networks: WWW, citation networks
- Social networks: Facebook, Twitter, but not just: this class, Marriage between Royal Houses
- Biological networks: "food webs" (what eats what?), metabolical networks

---

## Physical Networks

<img src = "images/gush_dan_train_system.jpg" style = "width: 60%">

.font80percent[
[מערכת להסעת המונים במטרופולין תל אביב](https://he.wikipedia.org/wiki/%D7%9E%D7%A2%D7%A8%D7%9B%D7%AA_%D7%9C%D7%94%D7%A1%D7%A2%D7%AA_%D7%94%D7%9E%D7%95%D7%A0%D7%99%D7%9D_%D7%91%D7%9E%D7%98%D7%A8%D7%95%D7%A4%D7%95%D7%9C%D7%99%D7%9F_%D7%AA%D7%9C_%D7%90%D7%91%D7%99%D7%91)
]
---

## Information Networks

<img src = "images/wikipedia_site_map.png" style = "width: 100%">

.font80percent[
[Wikipedia Main Page Site Map](https://en.wikipedia.org/wiki/Site_map)
]
---

## Social Networks

<img src = "images/the_marker_judges.png" style = "width: 80%">

.font80percent[
[חשיפה: הרשימה שכל עורך דין חייב להכיר](https://www.themarker.com/law/1.3065986)
]
---

## Biological Networks

<img src = "images/worm_neural_network.png" style = "width: 80%">

.font80percent[
[The structure of the nervous system of the nematode Caenorhabditis elegans](https://royalsocietypublishing.org/doi/abs/10.1098/rstb.1986.0056)
]
---

## Harder to classify Networks

<img src = "images/john_lennon_timeline.png" style = "width: 100%">

---

## Bipartite Networks

<img src = "images/marvel_co_occurrence.png" style = "width: 80%">

`r emo::ji("arrow_right")`

---

## Bipartite Networks

<img src = "images/marvel_bipartite_network.png" style = "width: 80%">

.font80percent[
[Adapted from: Which Marvel Characters and Movies are the Most Central? / Félix Luginbühl](https://felixluginbuhl.com/network/)
]

---

## Similarity Networks

<img src = "images/sci_fi_books_table.png" style = "width: 100%">

`r emo::ji("arrow_right")`

---

## Similarity Networks

<img src = "images/sci_fi_books_cor_mat.png" style = "width: 75%">

`r emo::ji("arrow_right")`

---

## Similarity Networks

<img src = "images/sci_fi_books_network.png" style = "width: 100%">

.font80percent[
[Sci-Fi Books data set / Kathleen M. Carley](http://www.casos.cs.cmu.edu/tools/datasets/internal/index.php#sci-fi)
]

---

## Multilayer Networks

<img src = "images/noordin_multiplex.png" style = "width: 60%">

.font80percent[
[Strategies for Combating Dark Networks (a.k.a Noordin Mohammad Top’s terrorist network of South East Asia](https://pdfs.semanticscholar.org/e680/6d8f86c5ddc3daf6f65572e39f65bd0d2990.pdf)
]

---

## Trees 

<img src = "images/math_expr_parsed.png" style = "width: 65%">

.insight[
`r emo::ji("bulb")` Does this remind you of anything?
]

---

## Networks Properties

- Directed/Not: Do the edges have orientation?
- Weighted edges/Not: Do the edges have weight/strength/length?
- Connected/Not: Can you "get to" any node from any node?
- Self-edges/Not: Can a node be linked to itself?
- Acyclic/Not: Are there cycles? Can you get from one node to itself not by a self-loop?
- Time-varied/Not: Does the network change over time?

---

## The networks we've seen

.font80percent[
Network                    | Directed | Weighted | Connected | Self-edges | Acyclic | Time-Varied
-------------------------- | -------- | -------- | --------- | ---------- | ------- | -----------
Israeli Artists Coops      |          |          |           |            |         | 
Gush Dan Trains            |          |          |           |            |         | 
Wikipedia Site Map         |          |          |           |            |         | 
Israeli Judges Connections |          |          |           |            |         | 
Worm Nervous System        |          |          |           |            |         | 
John Lennon Timeline       |          |          |           |            |         | 
Marvel Cinematic Universe  |          |          |           |            |         | 
Sci-Fi Books               |          |          |           |            |         | 
Noordin Terrorist Net      |          |          |           |            |         | 
Math Expression            |          |          |           |            |         | 

]

---

## The networks we've seen

```{r Emojis, echo=FALSE}
v <- emo::ji("check")
```

.font80percent[
Network                    | Directed | Weighted | Connected | Self-edges | Acyclic | Time-Varied
-------------------------- | -------- | -------- | --------- | ---------- | ------- | -----------
Israeli Artists Coops      |          |          |    `r v`  |            |         | `r v`
Gush Dan Trains            |          |          |    `r v`  |            |         | 
Wikipedia Site Map         |  `r v`   |          |    weakly |            |  `r v`  | 
Israeli Judges Connections |          |          |           |            |         | `r v`
Worm Nervous System        |  `r v`   | `r v`    |    weakly |  `r v`     |         | 
John Lennon Timeline       |  `r v`   |          |    weakly |            |  `r v`  | `r emo::ji("sad")`
Marvel Cinematic Universe  |          |          |    `r v`  |            |         | `r v`
Sci-Fi Books               |          |  `r v`   |           |            |         | 
Noordin Terrorist Net      |          |          |           |            |         | 
Math Expression            |   `r v`  |          |    weakly |            | `r v`   | 

]

---

## Typical Questions About Networks

### Macro:

- Is the network connected?
- Is the network dense or sparse?
- What is the maximum/average shortest path? .font80percent[small world effect]
- Is the network homophilic for attribute X?
- Are there interesting communities in the network?
- Will a "message" percolate through the whole network? How fast?
- Can we model the network to give insight on how it developed? Predict how it *will* develop?

---

## Typical Questions About Networks

### Micro:

- Which is the "best connected" node?
- Which is the "most important" node? .font80percent[Not necessarily the same thing]
- Is there a node or edge which "break" the network?
- Is there a path between node A and node B?
- What is the shortest path between node A and node B?
- Are nodes A and B likely to connect?
- What node should we recommend connect with node A?

---

## Obtaining Networks

- Surveys, Interviews, Questionnaires, Observations .font80percent[(Moreno's schoolchildren)]
- Archives, sometimes historical .font80percent[(Padget's families of Florence)]
- Snowball Sampling .font80percent[(Drug users' ego networks)]
- Web Scraping .font80percent[(Adamic's political blogs)]
- Web APIs .font80percent[(Twitter)]
- Co-occurrence matrices .font80percent[(Marvel's cinematic universe)]
- Any tabular dataset? .font80percent[(Sci-Fi books)]
- Just really hard work .font80percent[(Milgram's Small world experiment)]

---

class: section-slide

# The Adjacency Matrix

---

## Undirected Networks

The Adjacency matrix $A$ of an unweighted network is defined as a $n\times n$ matrix with elements $A_{ij}$ such that:

$$A_{i,j} =
 \begin{cases}
   1 & \mbox{if there is an edge between nodes}\ i \mbox{ and}\ j \\
   0 & \mbox{otherwise}
 \end{cases}$$

- The adjacency of a simple undirected network would be symmetric and contain only zeros on its diagonal
- If the network has multiedges - if there are $q$ edges between elements $i$ and $j$ - then $A_{ij} = q$
- If the network has self-edges - if there is an edge between element $i$ and itself - then $A_{ii} = 2$ (useful convention)
---

So this unweighted, undirected network:

```{r Simple-Graph, echo=FALSE, warning=FALSE, message=FALSE, out.width="30%"}
library(tidygraph)
library(ggraph)
g <- tbl_graph(nodes = tibble(id = 1:5),
               edges = tibble(from = c(1:3, 1, 2),
                              to = c(2, 3, 5, 3, 5),
                              weight = c(0.2, 1, 2, 0.4, 0.1)))
ggraph(g, layout = "fr") +
  geom_node_point(size = 5) +
  geom_edge_link() +
  geom_node_text(aes(label = id), size = 15, vjust = 0.3, hjust = -0.2) +
  theme_graph()
```

Would be represented as $A_{5\times 5}$:

```{r Adj-Matrix-Test, echo = FALSE, results='asis'}
x <- as.matrix(rbind(c(0, 1, 1, 0, 0),
                     c(1, 0, 1, 0, 1),
                     c(1, 1, 0, 0, 1),
                     c(0, 0, 0, 0, 0),
                     c(0, 1, 1, 0, 0)))

matrix2latex(x)
```

---

For an undirected *weighted* network, $A_{ij}$ would contain the weight.
- The higher the weight - the stronger the connection
- (In absolute value - because a weight needs not be positive)

```{r Weighted-Graph, echo=FALSE, warning=FALSE, out.width="30%"}
ggraph(g, layout = "fr") +
  geom_node_point(size = 5) +
  geom_edge_link(aes(label = weight, width = weight),
                 label_size = 10, alpha = 0.5, show.legend = FALSE) +
  geom_node_text(aes(label = id), size = 15, vjust = 0.3, hjust = -0.2) +
  theme_graph()
```

```{r Adj-Matrix-Weighted, echo = FALSE, results='asis'}
x <- as.matrix(rbind(c(0, 0.2, 0.4, 0, 0),
                     c(0.2, 0, 1, 0, 0.1),
                     c(0.4, 1, 0, 0, 2),
                     c(0, 0, 0, 0, 0),
                     c(0, 0.1, 2, 0, 0)))

matrix2latex(x)
```

---

## Directed Networks (a.k.a DiGraph)

The Adjacency matrix $A$ of an unweighted network is defined as a $n\times n$ matrix with elements $A_{ij}$ such that:

$$A_{i,j} =
 \begin{cases}
   1 & \mbox{if there is an edge from node}\ j \mbox{ to node}\ i \\
   0 & \mbox{otherwise}
 \end{cases}$$

Note the convention from *column* index to *row* index can be confusing.

---

So this unweighted, directed network:

```{r Directed-Graph, echo=FALSE, warning=FALSE, out.width="30%"}
g <- tbl_graph(nodes = tibble(id = 1:5),
               edges = tibble(from = c(1, 2, 5, 3, 2),
                              to = c(2, 3, 3, 1, 5),
                              weight = c(0.2, 1, 2, 0.4, 0.1)), directed = TRUE)
ggraph(g, layout = "fr") +
  geom_edge_link(arrow = arrow(length = unit(6, 'mm'), type = "closed")) +
  geom_node_text(aes(label = id), size = 15, vjust = 0.2, hjust = -0.2) +
  theme_graph()
```

Would be represented as $A_{5\times 5}$:

```{r Adj-Matrix-Directed, echo = FALSE, results='asis'}
x <- as.matrix(rbind(c(0, 0, 1, 0, 0),
                     c(1, 0, 0, 0, 0),
                     c(0, 1, 0, 0, 1),
                     c(0, 0, 0, 0, 0),
                     c(0, 1, 0, 0, 0)))

matrix2latex(x)
```

---

## Directed Acyclic Graphs (DAG)

- If the network is directed and has no cycles, it is possible to draw the network such that all edges point downward, from a higher-numbered node into a lower-numbered node.
- If the network can be drawn where any edge from $j$ to $i$ implies that $j > i$, its adjacency matrix is *upper triangular*
- Since the diagonal contains only zeros (why) it is *strictly traingular*
- The other direction also holds (iff)

Is the netwok from previous page acyclic? Try both directions.

---

For example, this acyclic network can be numbered so that its adjacency matrix is strictly triangular:

```{r DAG, echo=FALSE, warning=FALSE, out.width="30%"}
g <- tbl_graph(nodes = tibble(id = 5:1),
               edges = tibble(from = c(1, 2, 3, 1, 2),
                              to = c(2, 3, 5, 4, 5),
                              weight = c(0.2, 1, 2, 0.4, 0.1)), directed = TRUE)
ggraph(g, layout = "sugiyama") +
  geom_edge_link(arrow = arrow(length = unit(6, 'mm'), type = "closed")) +
  geom_node_text(aes(label = id), size = 15, vjust = 0.5, hjust = 0) +
  theme_graph()
```

Would be represented as $A_{5\times 5}$:

```{r Adj-Matrix-DAG, echo = FALSE, results='asis'}
x <- as.matrix(rbind(c(0, 0, 1, 1, 0),
                     c(0, 0, 0, 0, 1),
                     c(0, 0, 0, 1, 0),
                     c(0, 0, 0, 0, 1),
                     c(0, 0, 0, 0, 0)))

matrix2latex(x)
```

---

### Example: the Math Expression Parse Tree

```{r Math-Expr-Network1, echo=FALSE, warning=FALSE, out.width="30%"}
nodes <- tribble(
  ~id, ~label,
  11, "-",
  2, "2",
  6, "+",
  1, "3",
  8, "6",
  10, "*",
  4, "-1",
  7, "+",
  3, "5",
  5, "2",
  9, "^"
)

edges <- tribble(
  ~from, ~to,
  1, 11,
  11, 3,
  11, 10,
  3, 4,
  3, 2,
  1, 6,
  6, 5,
  6, 8,
  8, 7,
  8, 9
)

math_expr <- tbl_graph(nodes = nodes, edges = edges, directed = TRUE)

ggraph(math_expr, layout = "tree") +
  geom_node_point(size = 20, color = "red", alpha = 0.1) +
  coord_flip() +
  geom_node_text(aes(label = label), repel = FALSE, size = 10, color = "blue", vjust = 1) +
  geom_edge_link(arrow = arrow(length = unit(3, 'mm'), type = "closed"), alpha = 0.7) +
  theme_graph() +
  theme(plot.title = element_text(hjust = 1, color = "blue")) +
  labs(title = "(2 + 3)^2 - 6 * (-1 + 5)")
```

```{r Math-Expr-Network2, echo=FALSE, warning=FALSE, out.width="30%"}
nodes <- tribble(
  ~id, ~label,
  11, "-",
  2, "2",
  6, "+",
  1, "3",
  8, "6",
  10, "*",
  4, "-1",
  7, "+",
  3, "5",
  5, "2",
  9, "^"
)

edges <- tribble(
  ~from, ~to,
  1, 11,
  11, 3,
  11, 10,
  3, 4,
  3, 2,
  1, 6,
  6, 5,
  6, 8,
  8, 7,
  8, 9
)

math_expr <- tbl_graph(nodes = nodes, edges = edges, directed = TRUE)

ggraph(math_expr, layout = "tree") +
  geom_node_point(size = 20, color = "red", alpha = 0.1) +
  geom_node_text(aes(label = id), repel = FALSE, size = 10, color = "blue", vjust = 1) +
  geom_edge_link(arrow = arrow(length = unit(3, 'mm'), type = "closed"), alpha = 0.7) +
  theme_graph() +
  theme(plot.title = element_text(hjust = 1, color = "blue"))
```

---

```{r Adj-Matrix-Math-Expr, echo = FALSE, results='asis'}
x <- as.matrix(rbind(c(0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0),
                     c(0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0),
                     c(0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0),
                     c(0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0),
                     c(0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0),
                     c(0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0),
                     c(0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0),
                     c(0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0),
                     c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1),
                     c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1),
                     c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
                     ))

matrix2latex(x)
```

---

## Bipartite Networks

We can write an Adjacency Matrix for a Bipartite Network (a.k.a *Two-Mode Network*) but a more compact representation exists: the Incidence Matrix.

If $n$ items belong to $g$ groups, the incidence matrix representing this bipartite network is $B_{g\times n}$ with elements $B_{ij}$ such that:

$$B_{i,j} =
 \begin{cases}
   1 & \mbox{if item}\ j \mbox{ belongs to group}\ i \\
   0 & \mbox{otherwise}
 \end{cases}$$
 
---

So this unweighted, undirected bipartite network of 5 items belonging to 4 groups:

```{r Bipartite-Network, echo=FALSE, out.width="30%"}
g <- tbl_graph(nodes = tibble(id = 1:9, name = c(1:4, letters[1:5]),
                              type = c(rep(TRUE, 4), rep(FALSE, 5))),
               edges = tibble(from = c(5, 5, 8, 8, 7, 7, 7, 6, 6, 6, 9, 9),
                              to = c(1, 2, 2, 4, 2, 4, 3, 1, 2, 3, 4, 3)))
ggraph(g, layout = "bipartite") +
  geom_node_point(aes(color = type), size = 5, show.legend = FALSE) +
  geom_edge_link() +
  geom_node_text(aes(label = name), size = 15, vjust = 0.3, hjust = -0.2) +
  theme_graph()
```

Would be represented as $B_{4\times 5}$:

```{r Incidence-Matrix, echo = FALSE, results='asis'}
x <- as.matrix(rbind(c(1, 1, 0, 0, 0),
                     c(1, 1, 1, 1, 0),
                     c(0, 1, 1, 0, 1),
                     c(0, 0, 1, 1, 1)))

matrix2latex(x)
```

---

## Bipartite Networks Projections

We can manually "project" a two-mode $g$ groups x $n$ items network into a one-mode undirected unweighted network of only $g$ groups or only $n$ items:

- If two items share a group - draw an edge between them.
- If two groups share an item - draw an edge between them.

<img src = "images/bipartite_projections.png" style = "width: 100%">

---

However, this representation results in a loss of information.

For example, we could add for each pair of items (groups) how many groups (items) they share, with a weighted edge:

