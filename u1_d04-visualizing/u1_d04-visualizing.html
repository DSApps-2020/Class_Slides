<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Visualizing in the Tidyverse</title>
    <meta charset="utf-8" />
    <meta name="author" content="Giora Simchoni" />
    <meta name="date" content="2019-12-14" />
    <head>
      <link rel="icon" href="../DSApps_logo.jpg" type="image/jpg"> 
      <link rel="shortcut icon" href="../DSApps_logo.jpg" type="image/jpg">
    </head>
    <link rel="stylesheet" href="..\slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">


class: logo-slide

---

class: title-slide

## Visualizing in the Tidyverse

### Applications of Data Science - Class 4

### Giora Simchoni

#### `gsimchoni@gmail.com and add #dsapps in subject`

### Stat. and OR Department, TAU
### 2019-12-14

---



layout: true

&lt;div class="my-footer"&gt;
  &lt;span&gt;
    &lt;a href="https://dsapps-2020.github.io/Class_Slides/" target="_blank"&gt;Applications of Data Science
    &lt;/a&gt;
  &lt;/span&gt;
&lt;/div&gt;

---



class: section-slide

# Welcome to `ggplot2`

#### Heavily inspired by datascienceinabox.org / @minebocek
---

## `ggplot()`

- **ggplot2** is tidyverse's data visualization package
- The `gg` in "ggplot2" stands for Grammar of Graphics
- It is inspired by the book [Grammar of Graphics](https://www.springer.com/gp/book/9780387245447) by Leland Wilkinson
- A grammar of graphics is a tool that enables us to concisely describe the components of a graphic

&lt;center&gt;&lt;img src = "images/grammar-of-graphics.png" style="width: 50%"&gt;&lt;/center&gt;

---

### Remember the Force, Luke!


```r
sw_tables &lt;- read_rds("../data/sw_tables.rds")
characters &lt;- sw_tables$characters
planets &lt;- sw_tables$planets
films &lt;- sw_tables$films

glimpse(characters)
```

```
## Observations: 173
## Variables: 14
## $ character_id &lt;int&gt; 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3...
## $ name         &lt;chr&gt; "Luke Skywalker", "Luke Skywalker", "Luke Skywalk...
## $ gender       &lt;chr&gt; "male", "male", "male", "male", "male", NA, NA, N...
## $ homeworld_id &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 8, 8, 8, 8, 8, 8...
## $ height       &lt;dbl&gt; 172, 172, 172, 172, 172, 167, 167, 167, 167, 167,...
## $ mass         &lt;dbl&gt; 77, 77, 77, 77, 77, 75, 75, 75, 75, 75, 75, 32, 3...
## $ hair_color   &lt;chr&gt; "blond", "blond", "blond", "blond", "blond", NA, ...
## $ skin_color   &lt;chr&gt; "fair", "fair", "fair", "fair", "fair", "gold", "...
## $ eye_color    &lt;chr&gt; "blue", "blue", "blue", "blue", "blue", "yellow",...
## $ birth_year   &lt;dbl&gt; 19.0, 19.0, 19.0, 19.0, 19.0, 112.0, 112.0, 112.0...
## $ film_id      &lt;dbl&gt; 1, 2, 3, 6, 7, 1, 2, 3, 4, 5, 6, 1, 2, 3, 4, 5, 6...
## $ species      &lt;list&gt; ["http://swapi.co/api/species/1/", "http://swapi...
## $ vehicles     &lt;list&gt; [&lt;"http://swapi.co/api/vehicles/14/", "http://sw...
## $ starships    &lt;list&gt; [&lt;"http://swapi.co/api/starships/12/", "http://s...
```

---

What are the functions doing the plotting? What is the dataset being plotted? 
Which variable is on the x-axis and which variable is on the y-axis? What does the warning mean?


```r
ggplot(data = characters, mapping = aes(x = height, y = mass)) +
  geom_point() +
  labs(title = "Mass vs. Height of Starwars characters",
       x = "Height (cm)", y = "Weight (kg)")
```

&lt;pre style="color: red;"&gt;&lt;code&gt;## Warning: Removed 36 rows containing missing values (geom_point).
&lt;/code&gt;&lt;/pre&gt;&lt;img src="images/Mass-Height1-1.png" width="70%" /&gt;

---

What does `geom_smooth()` do? What else changed between the previous plot and this one?


```r
ggplot(data = characters, mapping = aes(x = height, y = mass)) +
  geom_point() +
* geom_smooth() +
  labs(title = "Mass vs. Height of Starwars characters",
       x = "Height (cm)", y = "Weight (kg)")
```

&lt;img src="images/Mass-Height2-1.png" width="70%" /&gt;

---

## Who dis!

- `ggplot()` is the main function in ggplot2 and plots are constructed in layers
- The structure of the code for plots can often be summarized as

```r
ggplot + 
  geom_xxx
```

or, more precisely

```r
ggplot(data = [dataset], mapping = aes(x = [x-variable], y = [y-variable])) +
   geom_xxx() +
   other options
```

- To use ggplot2 functions, first load tidyverse

```r
library(tidyverse)
```
- For help with the ggplot2, see [ggplot2.tidyverse.org](http://ggplot2.tidyverse.org/)

---

## Mass vs. Height


```r
ggplot(characters, aes(height, mass)) + geom_point()
```

&lt;img src="images/Ggplot2-1.png" width="70%" /&gt;

How would you describe this relationship? What other variables would help us understand data points that don't follow the overall trend? Who is the not so tall but really chubby character?

---

## Jabba!


```r
library(magick)

jabba &lt;- image_read("images/jabba.png")
fig &lt;- image_graph(width = 2400, height = 1200, res = 300)
ggplot(data = characters, mapping = aes(x = height, y = mass)) +
  geom_point(size = 1.5) + 
  labs(title = "Mass vs. Height of Starwars characters",
       x = "Height (cm)", y = "Weight (kg)")
fig %&gt;% image_composite(jabba, offset = "+1000+30")
```

&lt;img src="images/JabbaPlot-1.png" width="70%" /&gt;

---

### But seriously, Luke

&lt;center&gt;&lt;img src = "images/luke-skywalker.png" style="width: 90%"&gt;&lt;/center&gt;

---

## Additional variables

We can map additional variables to various features of the plot:

- aesthetics
    - shape
    - colour
    - size
    - alpha (transparency)
- faceting: small multiples displaying different subsets

---
class: section-slide

# Aesthetics

---

## Aesthetics options

Visual characteristics of plotting characters that can be **mapped to a specific variable**
in the data are

- `color`
- `fill`
- `size`
- `shape`
- `alpha` (transparency)

---

### Mass vs. Height + Gender


```r
ggplot(data = characters,
       mapping = aes(x = height, y = mass, color = gender)) +
  geom_point()
```

&lt;img src="images/Ggplot3-1.png" width="70%" /&gt;

---

### Mass vs. Height + Gender + Birth Year

Let's map the size to `birth_year`:


```r
ggplot(data = characters,
       mapping = aes(x = height, y = mass, color = gender, 
*                    size = birth_year)) +
  geom_point()
```

&lt;img src="images/Aes1-1.png" width="70%" /&gt;

---

### Mass vs. Height + Gender

Let's now increase the size of all points **not** based on the values of a 
variable in the data:


```r
ggplot(data = characters,
       mapping = aes(x = height, y = mass, color = gender)) +
* geom_point(size = 2)
```

&lt;img src="images/Aes2-1.png" width="70%" /&gt;

---

## Aesthetics Summary

- Continuous variable are measured on a continuous scale
- Discrete variables are measured (or often counted) on a discrete scale

aesthetics    | discrete                 | continuous
------------- | ------------------------ | ------------
color         | rainbow of colors        | gradient
size          | discrete steps           | linear mapping between radius and value
shape         | different shape for each | shouldn't (and doesn't) work

- Use aesthetics for mapping features of a plot to a variable, define the 
features in the geom for customization **not** mapped to a variable

---
class: section-slide

# Faceting

---

### Faceting options

- Smaller plots that display different subsets of the data
- Useful for exploring conditional relationships and large data


```r
ggplot(data = characters, mapping = aes(x = height, y = mass)) +
* facet_grid(. ~ gender) +
  geom_point() +
  labs(title = "Mass vs. Height of Starwars characters",
*      subtitle = "Faceted by Gender",
       x = "Height (cm)", y = "Weight (kg)")
```

&lt;img src="images/Facet1-1.png" width="100%" /&gt;

---

### Many ways to facet



```r
ggplot(data = characters, mapping = aes(x = height, y = mass)) +
  geom_point() +
  facet_grid(gender ~ .)
```

&lt;img src="images/Facet2-1.png" width="50%" /&gt;

---


```r
ggplot(data = characters, mapping = aes(x = height, y = mass)) +
  geom_point() +
  facet_wrap(. ~ gender, scales = "free")
```

&lt;img src="images/Facet3-1.png" width="100%" /&gt;

---


```r
ggplot(data = characters, mapping = aes(x = height, y = mass)) +
  geom_point() +
  facet_wrap(~ eye_color)
```

&lt;img src="images/Facet4-1.png" width="60%" /&gt;

---

## Facet summary

- `facet_grid()`: 
    - 2d grid
    - `rows ~ cols`
    - use `.` for no split
- `facet_wrap()`: 1d ribbon wrapped into 2d

---
class: section-slide

# Take Control

---




```r
okcupid_lgbt_relig &lt;- okcupid %&gt;%
  group_by(religion2) %&gt;%
  summarise(pct_lgbt = mean(orientation %in% c("gay", "bisexual"))) %&gt;%
  mutate(religion = fct_reorder(religion2, desc(pct_lgbt)))

okcupid_lgbt_relig
```

```
## # A tibble: 7 x 3
##   religion2 pct_lgbt religion 
##   &lt;chr&gt;        &lt;dbl&gt; &lt;fct&gt;    
## 1 atheist     0.152  atheist  
## 2 buddhist    0.210  buddhist 
## 3 christian   0.0974 christian
## 4 hindu       0.0778 hindu    
## 5 jewish      0.117  jewish   
## 6 muslim      0.101  muslim   
## 7 NA          0.146  NA
```

---


```r
okcupid_lgbt_relig %&gt;%
  ggplot(aes(religion, pct_lgbt)) +
  geom_bar(stat="identity")
```

&lt;img src="images/Control2-1.png" width="60%" /&gt;

.font80percent[Meh.]

---

## Pimp my plot


```r
p &lt;- ggplot(okcupid_lgbt_relig, aes(religion, pct_lgbt)) +
  geom_bar(stat="identity", fill="#f68060", alpha=.6, width=.4) +
  labs(x = "", y = "",
       title = "OkCupid: %Reported LGBTQ+ by Religion") +
  theme(text = element_text(size = 14, color = "#163f59", family = "mono"),
        axis.text.y = element_text(size = 14)) +
  scale_y_continuous(breaks = seq(0.05, 0.2, 0.05),
                     labels=scales::percent_format(accuracy = 1)) +
  coord_flip()
p
```

---

## Pimp my plot

&lt;img src="images/Control4-1.png" width="100%" /&gt;

---

## Annotate, Add lines


```r
p + geom_hline(yintercept = 0.139, lty = 2, color = "#163f59") +
  annotate("text", x = 5, y = 0.139 + 0.03, label = "Overall %",
           color = "#163f59", family = "mono") +
  annotate(geom = "curve", x = 5, y = 0.15, xend = 4, yend = 0.139 + 0.001, 
    curvature = .3, arrow = arrow(length = unit(2, "mm")), color = "#163f59")
```

&lt;img src="images/Control5-1.png" width="90%" /&gt;

---
class: section-slide

# Themes

---


```r
p + theme_classic()
```

&lt;img src="images/Themes1-1.png" width="100%" /&gt;
---


```r
p + theme_light()
```

&lt;img src="images/Themes2-1.png" width="100%" /&gt;

---


```r
p + theme_dark()
```

&lt;img src="images/Themes3-1.png" width="100%" /&gt;

---


```r
p + theme_linedraw()
```

&lt;img src="images/Themes4-1.png" width="100%" /&gt;

---


```r
library(tvthemes)
# import_simpsons()
extrafont::loadfonts(device="win")

p + theme_simpsons(title.font = "Akbar",
                 text.font = "Akbar",
                 axis.text.size = 12)
```

&lt;img src="images/Themes5-1.png" width="100%" /&gt;

---


```r
ggplot(okcupid_lgbt_relig, aes(religion, pct_lgbt)) +
  geom_bar(aes(fill = pct_lgbt), stat="identity", alpha=.6, width=.4) +
  labs(x = "", y = "", title = "This was supposed to be GoT...") +
  scale_y_continuous(breaks = seq(0.05, 0.2, 0.05), labels=scales::percent_format(accuracy = 1)) +
  coord_flip() +
  scale_fill_westeros(palette = "Tyrell", type = "continuous") + theme_minimal() +
  theme(text = element_text(family = "Cinzel", size = 12),
        title = element_text(family = "Cinzel", size = 14)) + guides(fill=FALSE)
```

&lt;img src="images/Themes6-1.png" width="100%" /&gt;

---
class: section-slide

# Common Plots Ã  la GG

---

## Line Plot


```r
library(hrbrthemes)

characters %&gt;%
  group_by(film_id) %&gt;%
  summarise(n_char = n_distinct(character_id)) %&gt;%
  ggplot(aes(film_id, n_char)) +
* geom_line(lwd = 2) +
  labs(x = "", y = "No. of Characters",
       title = "Star Wars Films No. of Unique Characters") +
  scale_x_continuous(breaks = 1:7, labels = films$title) +
  theme_ipsum() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

---

&lt;img src="images/Line2-1.png" width="100%" /&gt;

---

## Histogram


```r
library(scales)

sex_names &lt;- list(
  "m" = "men",
  "f" = "women"
)

sex_labeller &lt;- function(variable, value){
  return(sex_names[value])
}

p2 &lt;- okcupid %&gt;%
  ggplot(aes(income)) +
  facet_wrap(. ~ sex, labeller = sex_labeller) +
  scale_x_log10(breaks = trans_breaks("log10", function(x) 10^x),
                labels = trans_format("log10", math_format(10^.x))) +
  labs(x = "", y = "", title = "OkCupid: Annual Income Dist. by Gender",
       caption = "Income is presented as log10(Income)") +
  theme_ipsum()

*p2 + geom_histogram()
```
---

&lt;img src="images/Hist2-1.png" width="100%" /&gt;

---

## Density Plot


```r
p2 + geom_density()
```

&lt;img src="images/Dens-1.png" width="100%" /&gt;

---

## Box Plot


```r
p3 &lt;- okcupid %&gt;%
  sample_n(5000) %&gt;%
  ggplot(aes(sex, income)) +
  scale_y_log10(breaks = trans_breaks("log10", function(x) 10^x),
                labels = trans_format("log10", math_format(10^.x))) +
  labs(x = "", y = "", title = "OkCupid: Annual Income Dist. by Gender",
       caption = "Income is presented as log10(Income)") +
  scale_x_discrete(labels = c("women", "men")) +
  theme_ipsum()

*p3 + geom_boxplot()
```

---

&lt;img src="images/Boxplot1-1.png" width="80%" /&gt;

---

## Violin Plot


```r
p3 + geom_violin(fill = "darkgreen", alpha = 0.6)
```

&lt;img src="images/Violin-1.png" width="80%" /&gt;

---

## Swarm Plot


```r
p3 + ggbeeswarm::geom_quasirandom(aes(color = sex)) + guides(color=FALSE)
```

&lt;img src="images/Swarm-1.png" width="80%" /&gt;
---

## Bar Plot


```r
p + theme_ipsum()
```

&lt;img src="images/Bar-1.png" width="100%" /&gt;
---

## Segmented Bar Plots: Counts



```r
p4 &lt;- ggplot(
  okcupid %&gt;%
    mutate(orientation = recode(orientation, "gay" = "lgbt", "bisexual" = "lgbt"),
           religion = fct_relevel(religion2,
                                  count(okcupid, religion2, sort = TRUE)$religion2)),
  aes(religion, fill = orientation)
  ) +
  labs(x = "", y = "",
       title = "OkCupid: Orientation by Religion") +
  scale_y_continuous(breaks = seq(0, 25000, 5000)) +
  coord_flip() +
  theme_ipsum() + theme(text = element_text(size = 14))
```

---


```r
p4 + geom_bar(alpha=.6, width=.4)
```

&lt;img src="images/Bar-Segmented2-1.png" width="100%" /&gt;

---

## Segmented Bar Plots: Proportions


```r
p4 + geom_bar(position = "fill", alpha=.6, width=.4)
```

&lt;img src="images/Bar-Segmented3-1.png" width="100%" /&gt;

.font80percent[
Hoping you can see why this is worse than our original plot.
]
---

## Mosaic Plots


```r
library(ggmosaic)

okcupid %&gt;%
  mutate(orientation = recode(orientation, "gay" = "lgbt", "bisexual" = "lgbt"),
         religion = fct_relevel(religion2, count(okcupid, religion2, sort = TRUE)$religion2)) %&gt;%
ggplot() +
* geom_mosaic(aes(x = product(orientation, religion), fill=orientation)) +
  labs(x = "", y = "", title = "OkCupid: Orientation by Religion") +
  guides(fill=FALSE) +
  theme_ipsum() +
  theme(axis.text.y = element_text(size = 14),
        axis.text.x = element_text(angle = 90, vjust = 0.5, size = 12))
```

---

&lt;img src="images/Mosaic2-1.png" width="100%" /&gt;

---

## Radar Chart


```r
okcupid %&gt;%
  group_by(religion2) %&gt;%
  summarise(drugs = mean(drugs %in% c("sometimes", "often"), na.rm = TRUE),
            smokes = mean(smokes == "yes", na.rm = TRUE),
            overweight = mean(body_type == "overweight", na.rm = TRUE),
            drinks = mean(drinks %in% c("often", "very often", "desperately"))
            ) -&gt; okcupid_radar
okcupid_radar
```

```
## # A tibble: 7 x 5
##   religion2  drugs smokes overweight drinks
##   &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;
## 1 atheist   0.201  0.0473    0.0110  0.141 
## 2 buddhist  0.160  0.0302    0.00494 0.0775
## 3 christian 0.0649 0.0352    0.00994 0.0759
## 4 hindu     0.0733 0.0236    0.00725 0.0689
## 5 jewish    0.128  0.0197    0.00467 0.0607
## 6 muslim    0.180  0.136     0.0155  0.115 
## 7 NA        0.126  0.0427    0.00634 0.0911
```

---


```r
library(ggradar)

ggradar(okcupid_radar,  grid.max = 0.201, grid.mid = 0.10, values.radar = c("0%", "10%", "20%"),
        plot.title = "OkCupid: Health Indicators by Religion") + theme(plot.title = element_text(size = 18))
```

&lt;img src="images/Radar3-1.png" width="90%" /&gt;

---

## Sankey Diagram (Alluvial Plot)


```r
library(ggalluvial)

migration &lt;- read_rds("../data/migration.rds")

migration_long &lt;- migration %&gt;%
  pivot_longer(cols = -c(1:4),
               names_to = "country_orig",
               values_to = "n_migrants")

g7 &lt;- c("canada", "france", "germany", "italy", "japan", "united_kingdom", "united_states_of_america")

migration_long %&gt;%
  filter(year == 2019) %&gt;%
  filter_at(c("country_orig", "country_dest"), ~.x %in% g7) %&gt;%
  group_by(country_orig, country_dest) %&gt;%
  summarise(n_migrants = sum(n_migrants)) %&gt;%
  ggplot(aes(y = n_migrants, axis1 = country_orig, axis2 = country_dest)) +
* geom_alluvium(aes(fill = country_orig)) +
  geom_stratum(width = 1/12, fill = "black", color = "grey") +
  geom_label(stat = "stratum", infer.label = TRUE) +
  scale_x_discrete(limits = c("Origin", "Destination"), expand = c(.05, .05)) +
  scale_fill_brewer(type = "qual", palette = "Set1") +
  guides(fill = FALSE) +
  labs(y = "", title = "G7 Cross-Country Migration 2019") +
  scale_y_comma() + theme_ipsum()
```

---

&lt;img src="images/Sankey2-1.png" width="100%" /&gt;

---

## Heatmap


```r
gender_age_height_drink &lt;- okcupid %&gt;%
  mutate(age_group = case_when(
    age &lt; 30 ~ "19-29",
    age &lt; 40 ~ "30-39",
    age &lt; 50 ~ "40-49",
    age &lt; 60 ~ "50-59",
    TRUE ~ "60+"),
    height_group = case_when(
      height_cm &lt; 150 ~ "149-",
      height_cm &lt; 160 ~ "150-159",
      height_cm &lt; 170 ~ "160-169",
      height_cm &lt; 180 ~ "170-179",
      height_cm &lt; 190 ~ "180-189",
      TRUE ~ "190+")) %&gt;%
  group_by(sex, age_group, height_group) %&gt;%
  summarise(n = n(),
            drinks = mean(drinks %in% c("often", "very often", "desperately")))
```

---


```r
gender_age_height_drink
```

```
## # A tibble: 58 x 5
## # Groups:   sex, age_group [10]
##    sex   age_group height_group     n drinks
##    &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;        &lt;int&gt;  &lt;dbl&gt;
##  1 f     19-29     149-           163 0.0920
##  2 f     19-29     150-159       1963 0.102 
##  3 f     19-29     160-169       5620 0.110 
##  4 f     19-29     170-179       3113 0.130 
##  5 f     19-29     180-189        310 0.145 
##  6 f     19-29     190+            19 0.474 
##  7 f     30-39     149-            80 0.0625
##  8 f     30-39     150-159       1293 0.0673
##  9 f     30-39     160-169       4109 0.0810
## 10 f     30-39     170-179       2231 0.0852
## # ... with 48 more rows
```

---


```r
ggplot(gender_age_height_drink, aes(age_group, height_group, fill = drinks)) +
* geom_tile() +
  facet_wrap(. ~ sex, labeller = sex_labeller) +
  labs(x = "Age", y = "Height", title = "OkCupid: %Reported Drinking by Age and Height") +
  scale_fill_gradient(labels = percent_format(accuracy = 1)) +
  theme_ipsum()
```

&lt;img src="images/Heatmap2-1.png" width="100%" /&gt;

---
class: section-slide

# Amazing Extensions

---

## `ggraph`

---

## `gganimate`

---

## `ggrepel`

---

## `ggridges`

---

## `ggExtra`

---

## `sf`, `ggmap`

---

## `ggchicklet`

---

## `rayshader`

---

## `magick`

---

## `brickr`
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="../libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
